/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { AirweaveSDKClient } from "../../src/Client";
import * as AirweaveSDK from "../../src/api/index";

describe("Sources", () => {
    test("list (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                name: "GitHub",
                description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
                auth_methods: ["auth_methods"],
                oauth_type: "oauth_type",
                requires_byoc: true,
                auth_config_class: "GitHubAuthConfig",
                config_class: "GitHubConfig",
                short_name: "github",
                class_name: "GitHubSource",
                output_entity_definition_ids: [
                    "def12345-6789-abcd-ef01-234567890abc",
                    "def67890-abcd-ef01-2345-67890abcdef1",
                ],
                labels: ["code"],
                supports_continuous: true,
                id: "550e8400-e29b-41d4-a716-446655440000",
                created_at: "2024-01-01T00:00:00Z",
                modified_at: "2024-01-01T00:00:00Z",
                auth_fields: {
                    fields: [
                        {
                            name: "personal_access_token",
                            title: "Personal Access Token",
                            description: "GitHub Personal Access Token with repository read permissions",
                            type: "string",
                        },
                        {
                            name: "repo_name",
                            title: "Repository Name",
                            description: "Full repository name in format 'owner/repo'",
                            type: "string",
                        },
                    ],
                },
                config_fields: { fields: [{ name: "name", title: "title", type: "type" }] },
            },
        ];
        server.mockEndpoint().get("/sources").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.sources.list();
        expect(response).toEqual([
            {
                name: "GitHub",
                description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
                auth_methods: ["auth_methods"],
                oauth_type: "oauth_type",
                requires_byoc: true,
                auth_config_class: "GitHubAuthConfig",
                config_class: "GitHubConfig",
                short_name: "github",
                class_name: "GitHubSource",
                output_entity_definition_ids: [
                    "def12345-6789-abcd-ef01-234567890abc",
                    "def67890-abcd-ef01-2345-67890abcdef1",
                ],
                labels: ["code"],
                supports_continuous: true,
                id: "550e8400-e29b-41d4-a716-446655440000",
                created_at: "2024-01-01T00:00:00Z",
                modified_at: "2024-01-01T00:00:00Z",
                auth_fields: {
                    fields: [
                        {
                            name: "personal_access_token",
                            title: "Personal Access Token",
                            description: "GitHub Personal Access Token with repository read permissions",
                            type: "string",
                        },
                        {
                            name: "repo_name",
                            title: "Repository Name",
                            description: "Full repository name in format 'owner/repo'",
                            type: "string",
                        },
                    ],
                },
                config_fields: {
                    fields: [
                        {
                            name: "name",
                            title: "title",
                            type: "type",
                        },
                    ],
                },
            },
        ]);
    });

    test("list (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: undefined };
        server.mockEndpoint().get("/sources").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.sources.list();
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("read (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            name: "GitHub",
            description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
            auth_methods: ["auth_methods"],
            oauth_type: "oauth_type",
            requires_byoc: true,
            auth_config_class: "GitHubAuthConfig",
            config_class: "GitHubConfig",
            short_name: "github",
            class_name: "GitHubSource",
            output_entity_definition_ids: [
                "def12345-6789-abcd-ef01-234567890abc",
                "def67890-abcd-ef01-2345-67890abcdef1",
            ],
            labels: ["code"],
            supports_continuous: true,
            id: "550e8400-e29b-41d4-a716-446655440000",
            created_at: "2024-01-01T00:00:00Z",
            modified_at: "2024-01-01T00:00:00Z",
            auth_fields: {
                fields: [
                    {
                        name: "personal_access_token",
                        title: "Personal Access Token",
                        description: "GitHub Personal Access Token with repository read permissions",
                        type: "string",
                    },
                    {
                        name: "repo_name",
                        title: "Repository Name",
                        description: "Full repository name in format 'owner/repo'",
                        type: "string",
                    },
                ],
            },
            config_fields: { fields: [{ name: "name", title: "title", type: "type" }] },
        };
        server
            .mockEndpoint()
            .get("/sources/short_name")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.sources.read("short_name");
        expect(response).toEqual({
            name: "GitHub",
            description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
            auth_methods: ["auth_methods"],
            oauth_type: "oauth_type",
            requires_byoc: true,
            auth_config_class: "GitHubAuthConfig",
            config_class: "GitHubConfig",
            short_name: "github",
            class_name: "GitHubSource",
            output_entity_definition_ids: [
                "def12345-6789-abcd-ef01-234567890abc",
                "def67890-abcd-ef01-2345-67890abcdef1",
            ],
            labels: ["code"],
            supports_continuous: true,
            id: "550e8400-e29b-41d4-a716-446655440000",
            created_at: "2024-01-01T00:00:00Z",
            modified_at: "2024-01-01T00:00:00Z",
            auth_fields: {
                fields: [
                    {
                        name: "personal_access_token",
                        title: "Personal Access Token",
                        description: "GitHub Personal Access Token with repository read permissions",
                        type: "string",
                    },
                    {
                        name: "repo_name",
                        title: "Repository Name",
                        description: "Full repository name in format 'owner/repo'",
                        type: "string",
                    },
                ],
            },
            config_fields: {
                fields: [
                    {
                        name: "name",
                        title: "title",
                        type: "type",
                    },
                ],
            },
        });
    });

    test("read (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/sources/short_name")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sources.read("short_name");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });
});
