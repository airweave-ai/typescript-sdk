/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { AirweaveSDKClient } from "../../src/Client";
import * as AirweaveSDK from "../../src/api/index";

describe("Sources", () => {
    test("list (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                name: "GitHub",
                description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
                auth_methods: ["auth_methods"],
                oauth_type: "oauth_type",
                requires_byoc: true,
                auth_config_class: "GitHubAuthConfig",
                config_class: "GitHubConfig",
                short_name: "github",
                class_name: "GitHubSource",
                output_entity_definitions: ["output_entity_definitions"],
                labels: ["code"],
                supports_continuous: true,
                federated_search: true,
                supports_temporal_relevance: true,
                supports_access_control: true,
                rate_limit_level: "rate_limit_level",
                feature_flag: "feature_flag",
                auth_fields: {
                    fields: [
                        {
                            name: "personal_access_token",
                            title: "Personal Access Token",
                            description: "GitHub Personal Access Token with repository read permissions",
                            type: "string",
                        },
                        {
                            name: "repo_name",
                            title: "Repository Name",
                            description: "Full repository name in format 'owner/repo'",
                            type: "string",
                        },
                    ],
                },
                config_fields: { fields: [{ name: "name", title: "title", type: "type" }] },
                supported_auth_providers: ["supported_auth_providers"],
            },
        ];
        server.mockEndpoint().get("/sources").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.sources.list();
        expect(response).toEqual([
            {
                name: "GitHub",
                description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
                auth_methods: ["auth_methods"],
                oauth_type: "oauth_type",
                requires_byoc: true,
                auth_config_class: "GitHubAuthConfig",
                config_class: "GitHubConfig",
                short_name: "github",
                class_name: "GitHubSource",
                output_entity_definitions: ["output_entity_definitions"],
                labels: ["code"],
                supports_continuous: true,
                federated_search: true,
                supports_temporal_relevance: true,
                supports_access_control: true,
                rate_limit_level: "rate_limit_level",
                feature_flag: "feature_flag",
                auth_fields: {
                    fields: [
                        {
                            name: "personal_access_token",
                            title: "Personal Access Token",
                            description: "GitHub Personal Access Token with repository read permissions",
                            type: "string",
                        },
                        {
                            name: "repo_name",
                            title: "Repository Name",
                            description: "Full repository name in format 'owner/repo'",
                            type: "string",
                        },
                    ],
                },
                config_fields: {
                    fields: [
                        {
                            name: "name",
                            title: "title",
                            type: "type",
                        },
                    ],
                },
                supported_auth_providers: ["supported_auth_providers"],
            },
        ]);
    });

    test("list (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/sources").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.sources.list();
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("list (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: "detail" };
        server.mockEndpoint().get("/sources").respondWith().statusCode(429).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.sources.list();
        }).rejects.toThrow(AirweaveSDK.TooManyRequestsError);
    });

    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            name: "GitHub",
            description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
            auth_methods: ["auth_methods"],
            oauth_type: "oauth_type",
            requires_byoc: true,
            auth_config_class: "GitHubAuthConfig",
            config_class: "GitHubConfig",
            short_name: "github",
            class_name: "GitHubSource",
            output_entity_definitions: ["output_entity_definitions"],
            labels: ["code"],
            supports_continuous: true,
            federated_search: true,
            supports_temporal_relevance: true,
            supports_access_control: true,
            rate_limit_level: "rate_limit_level",
            feature_flag: "feature_flag",
            auth_fields: {
                fields: [
                    {
                        name: "personal_access_token",
                        title: "Personal Access Token",
                        description: "GitHub Personal Access Token with repository read permissions",
                        type: "string",
                    },
                    {
                        name: "repo_name",
                        title: "Repository Name",
                        description: "Full repository name in format 'owner/repo'",
                        type: "string",
                    },
                ],
            },
            config_fields: { fields: [{ name: "name", title: "title", type: "type" }] },
            supported_auth_providers: ["supported_auth_providers"],
        };
        server.mockEndpoint().get("/sources/github").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.sources.get("github");
        expect(response).toEqual({
            name: "GitHub",
            description: "Connect to GitHub repositories for code, issues, pull requests, and documentation",
            auth_methods: ["auth_methods"],
            oauth_type: "oauth_type",
            requires_byoc: true,
            auth_config_class: "GitHubAuthConfig",
            config_class: "GitHubConfig",
            short_name: "github",
            class_name: "GitHubSource",
            output_entity_definitions: ["output_entity_definitions"],
            labels: ["code"],
            supports_continuous: true,
            federated_search: true,
            supports_temporal_relevance: true,
            supports_access_control: true,
            rate_limit_level: "rate_limit_level",
            feature_flag: "feature_flag",
            auth_fields: {
                fields: [
                    {
                        name: "personal_access_token",
                        title: "Personal Access Token",
                        description: "GitHub Personal Access Token with repository read permissions",
                        type: "string",
                    },
                    {
                        name: "repo_name",
                        title: "Repository Name",
                        description: "Full repository name in format 'owner/repo'",
                        type: "string",
                    },
                ],
            },
            config_fields: {
                fields: [
                    {
                        name: "name",
                        title: "title",
                        type: "type",
                    },
                ],
            },
            supported_auth_providers: ["supported_auth_providers"],
        });
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: "detail" };
        server
            .mockEndpoint()
            .get("/sources/short_name")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sources.get("short_name");
        }).rejects.toThrow(AirweaveSDK.NotFoundError);
    });

    test("get (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/sources/short_name")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sources.get("short_name");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("get (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: "detail" };
        server
            .mockEndpoint()
            .get("/sources/short_name")
            .respondWith()
            .statusCode(429)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.sources.get("short_name");
        }).rejects.toThrow(AirweaveSDK.TooManyRequestsError);
    });
});
