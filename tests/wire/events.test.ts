/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { AirweaveSDKClient } from "../../src/Client";
import * as AirweaveSDK from "../../src/api/index";

describe("Events", () => {
    test("getMessages (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = [
            {
                channels: ["channels"],
                deliverAt: "2024-01-15T09:30:00Z",
                eventId: "eventId",
                eventType: "eventType",
                id: "id",
                payload: { key: "value" },
                tags: ["tags"],
                timestamp: "2024-01-15T09:30:00Z",
            },
        ];
        server.mockEndpoint().get("/events/messages").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.events.getMessages();
        expect(response).toEqual([
            {
                channels: ["channels"],
                deliverAt: "2024-01-15T09:30:00Z",
                eventId: "eventId",
                eventType: "eventType",
                id: "id",
                payload: {
                    key: "value",
                },
                tags: ["tags"],
                timestamp: "2024-01-15T09:30:00Z",
            },
        ]);
    });

    test("getMessages (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server.mockEndpoint().get("/events/messages").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.events.getMessages();
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("getMessage (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            channels: ["channels"],
            deliverAt: "2024-01-15T09:30:00Z",
            eventId: "eventId",
            eventType: "eventType",
            id: "id",
            payload: { key: "value" },
            tags: ["tags"],
            timestamp: "2024-01-15T09:30:00Z",
        };
        server
            .mockEndpoint()
            .get("/events/messages/message_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.getMessage("message_id");
        expect(response).toEqual({
            channels: ["channels"],
            deliverAt: "2024-01-15T09:30:00Z",
            eventId: "eventId",
            eventType: "eventType",
            id: "id",
            payload: {
                key: "value",
            },
            tags: ["tags"],
            timestamp: "2024-01-15T09:30:00Z",
        });
    });

    test("getMessage (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/events/messages/message_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.getMessage("message_id");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("getMessageAttempts (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = [
            {
                endpointId: "endpointId",
                id: "id",
                msg: {
                    channels: ["channels"],
                    deliverAt: "2024-01-15T09:30:00Z",
                    eventId: "eventId",
                    eventType: "eventType",
                    id: "id",
                    payload: { key: "value" },
                    tags: ["tags"],
                    timestamp: "2024-01-15T09:30:00Z",
                },
                msgId: "msgId",
                response: "response",
                responseDurationMs: 1,
                responseStatusCode: 1,
                status: 1,
                statusText: "success",
                timestamp: "2024-01-15T09:30:00Z",
                triggerType: 1,
                url: "url",
            },
        ];
        server
            .mockEndpoint()
            .get("/events/messages/message_id/attempts")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.getMessageAttempts("message_id");
        expect(response).toEqual([
            {
                endpointId: "endpointId",
                id: "id",
                msg: {
                    channels: ["channels"],
                    deliverAt: "2024-01-15T09:30:00Z",
                    eventId: "eventId",
                    eventType: "eventType",
                    id: "id",
                    payload: {
                        key: "value",
                    },
                    tags: ["tags"],
                    timestamp: "2024-01-15T09:30:00Z",
                },
                msgId: "msgId",
                response: "response",
                responseDurationMs: 1,
                responseStatusCode: 1,
                status: 1,
                statusText: "success",
                timestamp: "2024-01-15T09:30:00Z",
                triggerType: 1,
                url: "url",
            },
        ]);
    });

    test("getMessageAttempts (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/events/messages/message_id/attempts")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.getMessageAttempts("message_id");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("getSubscriptions (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = [
            {
                channels: ["channels"],
                createdAt: "2024-01-15T09:30:00Z",
                description: "description",
                disabled: true,
                filterTypes: ["filterTypes"],
                id: "id",
                metadata: { key: "value" },
                rateLimit: 1,
                uid: "uid",
                updatedAt: "2024-01-15T09:30:00Z",
                url: "url",
                version: 1,
            },
        ];
        server
            .mockEndpoint()
            .get("/events/subscriptions")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.getSubscriptions();
        expect(response).toEqual([
            {
                channels: ["channels"],
                createdAt: "2024-01-15T09:30:00Z",
                description: "description",
                disabled: true,
                filterTypes: ["filterTypes"],
                id: "id",
                metadata: {
                    key: "value",
                },
                rateLimit: 1,
                uid: "uid",
                updatedAt: "2024-01-15T09:30:00Z",
                url: "url",
                version: 1,
            },
        ]);
    });

    test("getSubscriptions (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/events/subscriptions")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.getSubscriptions();
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("createSubscription (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = { url: "url", event_types: ["sync.pending"] };
        const rawResponseBody = {
            channels: ["channels"],
            createdAt: "2024-01-15T09:30:00Z",
            description: "description",
            disabled: true,
            filterTypes: ["filterTypes"],
            id: "id",
            metadata: { key: "value" },
            rateLimit: 1,
            uid: "uid",
            updatedAt: "2024-01-15T09:30:00Z",
            url: "url",
            version: 1,
        };
        server
            .mockEndpoint()
            .post("/events/subscriptions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.createSubscription({
            url: "url",
            event_types: ["sync.pending"],
        });
        expect(response).toEqual({
            channels: ["channels"],
            createdAt: "2024-01-15T09:30:00Z",
            description: "description",
            disabled: true,
            filterTypes: ["filterTypes"],
            id: "id",
            metadata: {
                key: "value",
            },
            rateLimit: 1,
            uid: "uid",
            updatedAt: "2024-01-15T09:30:00Z",
            url: "url",
            version: 1,
        });
    });

    test("createSubscription (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = { url: "x", event_types: ["sync.pending", "sync.pending"], secret: undefined };
        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .post("/events/subscriptions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.createSubscription({
                url: "x",
                event_types: ["sync.pending", "sync.pending"],
                secret: undefined,
            });
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("getSubscription (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            endpoint: {
                channels: ["channels"],
                createdAt: "2024-01-15T09:30:00Z",
                description: "description",
                disabled: true,
                filterTypes: ["filterTypes"],
                id: "id",
                metadata: { key: "value" },
                rateLimit: 1,
                uid: "uid",
                updatedAt: "2024-01-15T09:30:00Z",
                url: "url",
                version: 1,
            },
            message_attempts: [
                {
                    endpointId: "endpointId",
                    id: "id",
                    msg: {
                        eventType: "eventType",
                        id: "id",
                        payload: { key: "value" },
                        timestamp: "2024-01-15T09:30:00Z",
                    },
                    msgId: "msgId",
                    response: "response",
                    responseDurationMs: 1,
                    responseStatusCode: 1,
                    status: 1,
                    statusText: "success",
                    timestamp: "2024-01-15T09:30:00Z",
                    triggerType: 1,
                    url: "url",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/events/subscriptions/subscription_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.getSubscription("subscription_id");
        expect(response).toEqual({
            endpoint: {
                channels: ["channels"],
                createdAt: "2024-01-15T09:30:00Z",
                description: "description",
                disabled: true,
                filterTypes: ["filterTypes"],
                id: "id",
                metadata: {
                    key: "value",
                },
                rateLimit: 1,
                uid: "uid",
                updatedAt: "2024-01-15T09:30:00Z",
                url: "url",
                version: 1,
            },
            message_attempts: [
                {
                    endpointId: "endpointId",
                    id: "id",
                    msg: {
                        eventType: "eventType",
                        id: "id",
                        payload: {
                            key: "value",
                        },
                        timestamp: "2024-01-15T09:30:00Z",
                    },
                    msgId: "msgId",
                    response: "response",
                    responseDurationMs: 1,
                    responseStatusCode: 1,
                    status: 1,
                    statusText: "success",
                    timestamp: "2024-01-15T09:30:00Z",
                    triggerType: 1,
                    url: "url",
                },
            ],
        });
    });

    test("getSubscription (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/events/subscriptions/subscription_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.getSubscription("subscription_id");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("deleteSubscription (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/events/subscriptions/subscription_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.deleteSubscription("subscription_id");
        expect(response).toEqual({
            key: "value",
        });
    });

    test("deleteSubscription (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .delete("/events/subscriptions/subscription_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.deleteSubscription("subscription_id");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("patchSubscription (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = {};
        const rawResponseBody = {
            channels: ["channels"],
            createdAt: "2024-01-15T09:30:00Z",
            description: "description",
            disabled: true,
            filterTypes: ["filterTypes"],
            id: "id",
            metadata: { key: "value" },
            rateLimit: 1,
            uid: "uid",
            updatedAt: "2024-01-15T09:30:00Z",
            url: "url",
            version: 1,
        };
        server
            .mockEndpoint()
            .patch("/events/subscriptions/subscription_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.patchSubscription("subscription_id");
        expect(response).toEqual({
            channels: ["channels"],
            createdAt: "2024-01-15T09:30:00Z",
            description: "description",
            disabled: true,
            filterTypes: ["filterTypes"],
            id: "id",
            metadata: {
                key: "value",
            },
            rateLimit: 1,
            uid: "uid",
            updatedAt: "2024-01-15T09:30:00Z",
            url: "url",
            version: 1,
        });
    });

    test("patchSubscription (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = { url: undefined, event_types: undefined, disabled: undefined };
        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .patch("/events/subscriptions/subscription_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.patchSubscription("subscription_id", {
                url: undefined,
                event_types: undefined,
                disabled: undefined,
            });
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("enableSubscription (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = {};
        const rawResponseBody = {
            channels: ["channels"],
            createdAt: "2024-01-15T09:30:00Z",
            description: "description",
            disabled: true,
            filterTypes: ["filterTypes"],
            id: "id",
            metadata: { key: "value" },
            rateLimit: 1,
            uid: "uid",
            updatedAt: "2024-01-15T09:30:00Z",
            url: "url",
            version: 1,
        };
        server
            .mockEndpoint()
            .post("/events/subscriptions/subscription_id/enable")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.enableSubscription("subscription_id");
        expect(response).toEqual({
            channels: ["channels"],
            createdAt: "2024-01-15T09:30:00Z",
            description: "description",
            disabled: true,
            filterTypes: ["filterTypes"],
            id: "id",
            metadata: {
                key: "value",
            },
            rateLimit: 1,
            uid: "uid",
            updatedAt: "2024-01-15T09:30:00Z",
            url: "url",
            version: 1,
        });
    });

    test("enableSubscription (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .post("/events/subscriptions/subscription_id/enable")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.enableSubscription("subscription_id", undefined);
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("getSubscriptionSecret (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { key: "key" };
        server
            .mockEndpoint()
            .get("/events/subscriptions/subscription_id/secret")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.getSubscriptionSecret("subscription_id");
        expect(response).toEqual({
            key: "key",
        });
    });

    test("getSubscriptionSecret (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/events/subscriptions/subscription_id/secret")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.getSubscriptionSecret("subscription_id");
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });

    test("recoverFailedMessages (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = { since: "2024-01-15T09:30:00Z" };
        const rawResponseBody = { id: "id", status: "running", task: "endpoint.replay" };
        server
            .mockEndpoint()
            .post("/events/subscriptions/subscription_id/recover")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.events.recoverFailedMessages("subscription_id", {
            since: "2024-01-15T09:30:00Z",
        });
        expect(response).toEqual({
            id: "id",
            status: "running",
            task: "endpoint.replay",
        });
    });

    test("recoverFailedMessages (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new AirweaveSDKClient({
            apiKey: "test",
            frameworkName: "test",
            frameworkVersion: "test",
            environment: server.baseUrl,
        });
        const rawRequestBody = { since: "2024-01-15T09:30:00Z", until: undefined };
        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .post("/events/subscriptions/subscription_id/recover")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.events.recoverFailedMessages("subscription_id", {
                since: "2024-01-15T09:30:00Z",
                until: undefined,
            });
        }).rejects.toThrow(AirweaveSDK.UnprocessableEntityError);
    });
});
